<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Chip 8 Emulator</title>
</head>
<body>
<H3>Chip 8 Emulator written in JavaScript for HTML 5 browser</H3>
Author: Kenny Goh<BR>
Date: 3/25/2015<BR>
License under MIT<BR>
<hr>

<div style="margin-top: 20px;">
    <div id="program" style="margin-top: 10px;">
        Program: <input type="file" id="programInput" style="width: 30em;">
    </div>
    <div id="cpuController" style="margin-top: 10px;">
        CPU Controller
        <button disabled>Start</button>
        <button disabled>Halt</button>
        <button disabled>Next</button>
        <button disabled>Reset</button>
        Counter <input type="text" id="counterText" style="width: 5em;" readonly>
        Status <input type="text" id="statusText" style="width: 5em;" readonly>
    </div>
    <div style="margin-top: 10px;">
        <table>
            <tr>
                <td valign="top">
                    Display
                    <div>
                        <canvas id="display"
                             style="background-color: #000000; width: 640px; height: 320px;">

                        </canvas>
                    </div>
                </td>
                <td valign="top">
                    Keyboard
                    <div id="controller" >
                        <table>
                            <tr>
                                <td><button>1</button></td>
                                <td><button>2</button></td>
                                <td><button>3</button></td>
                                <td><button>C</button></td>
                            </tr>
                            <tr>
                                <td><button>4</button></td>
                                <td><button>5</button></td>
                                <td><button>6</button></td>
                                <td><button>D</button></td>
                            </tr>
                            <tr>
                                <td><button>7</button></td>
                                <td><button>8</button></td>
                                <td><button>9</button></td>
                                <td><button>E</button></td>
                            </tr>
                            <tr>
                                <td><button>A</button></td>
                                <td><button>0</button></td>
                                <td><button>B</button></td>
                                <td><button>F</button></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div>
        Debugger<BR>
        <table>
            <tr>
                <td valign="top">
                    <div id ='register'>
                        Register<BR>
                        <div>
                        <textarea id ="registerTextArea" rows="4095" cols="25" style ="height: 300px;max-height: 3000px;" readonly>
                        </textarea>
                        </div>
                    </div>
                </td>
                <td valign="top">
                    <div id ='memory'>
                        Memory<BR>
                        <textarea id="memoryTextArea" rows="4095" cols="25" style ="height: 300px;max-height: 300px;">

                        </textarea>
                    </div>
                </td>
                <td valign="top">
                    <div>
                        Stack pointer<BR>
                        <textarea id="stackPtrTextArea" rows="1" cols="25" style ="height: 20px;max-height: 20px;" readonly></textarea>
                    </div>
                </td>
                <td valign="top">
                    <div>
                        Stack<BR>
                        <textarea id ="stackTextArea" rows="16" cols="25" style ="height: 300px;max-height: 300px;" readonly>
                        </textarea>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>
<script src="jquery-2.1.3.js" ></script>
<script src="chip8.js" ></script>
<script>
    var chip8VM = new Chip8VM();


    $( "#programInput" ).change(function() {
        console.log("Program file is chosen");
        var file = this.files[0];
        console.log(file);
        var reader = new FileReader();
        reader.onload = function(e) {
            loadDataAsHex(reader);
        };
        reader.readAsBinaryString(file);
    });

    function loadDataAsHex(fr) {
        var hexString, result, n, aByte, byteStr;

        hexString = [];
        result = fr.result;
        for (n = 0; n < result.length; ++n) {
            aByte = result.charCodeAt(n);
            byteStr = aByte.toString(16);
            if (byteStr.length < 2) {
                byteStr = "0" + byteStr;
            }
            hexString.push(byteStr);
        }

        chip8VM.reset();
        chip8VM.loadFromHexString(hexString.join(" "));
        chip8VM.start();
    }

</script>
</body>
</html>